<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="styles.css">

  <title>Game</title>
</head>

<body>
  <div>
    <div>
    <button type="button" , onclick="remove()" , id="btn">Press to stop</button>
  </div>
    <canvas id="cv" width="500" height="500" style="border: 1px solid black;"></canvas>
  </div>
  <div>
    <p>Click above to start, avoid the rectangles.</p>
  </div>
</body>
<script>
  const canvas = document.getElementById("cv");
  const ctx = canvas.getContext("2d");
  let size = canvas.width;
  let move = null;
  let pressed = false;
  //size
  let a = 0;
  let b = 0;
  //switch between the two options of rectangle going up or down
  let rand = Math.random();
  let rand2 = Math.random();
  //x and y coordinates
  let randx  = 0;
  let randy = 0;
  let randx2  = 0;
  let randy2 = 0;
  //to track coordinates of the two other corners
  let width1 = 0;
  let height1 = 0;
  let width2 = 0;
  let height2 = 0;
  let stopped = false;
  let mmv = {x: 0, y: 0};
  console.log(randx);
    console.log(randy);

  function clicked() {
    console.log(done);
    draw();
  }
  canvas.addEventListener('click',() => draw(event), true);
  canvas.addEventListener('mousemove',  drawmouse, false);

  function draw(e) {
    if(pressed == false) {
      newstart();
      move = setInterval(() => rect(), 100);
      pressed = true;
    }
  };

  function drawmouse(e) {
    mmv = getMousePos(e)
    ctx.fillRect(mmv.x, mmv.y, 4,4);
    checkOut();
  }

  function remove() {
    clearInterval(move);
    ctx.clearRect(0,0, canvas.width, canvas.height);
    clearInterval();
    pressed = false;
  }
  //create rectangles
  function rect() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    let rect1 = ctx.fillRect(randx, randy, a, b);
    let rect2 = ctx.fillRect(randx2, randy2, a, b)
    //need to sort out width
    if(rand > 0.5 ) {
      movementneg();
    } else {
      movementpos();
    }
  }
  //check if mouse is over rectangles
  function checkOut() {
    if(((mmv.x > randx && mmv.x < width1) || (mmv.x < randx && mmv.x > width1)) && 
    ((mmv.y > randy && mmv.y < height1) || (mmv.y < randy && mmv.y > height1))) {
      console.log("inside1 " + mmv.x + " " + mmv.y + " " + width1, height1 + " " + width2, height2);
    }
    if(((mmv.x > randx2 && mmv.x < width2) || (mmv.x < randx2 && mmv.x > width2)) && 
    ((mmv.y > randy2 && mmv.y < height2) || (mmv.y < randy2 && mmv.y > height2))) {
      console.log("inside2 " + mmv.x + mmv.y + " " +width2, height2)
    }
  }

  //move left up
  function movementpos() {
    if ((width1 < canvas.width &&  width1 > 0 && height1 < canvas.width && height1 > 0) || (width2 < canvas.width &&  width2 > 0 && height2 < canvas.height && height2 > 0)){     
      a = a + 3;
      b = b + 3;
      width1 = randx + Math.abs(a);
      height1 = randy + Math.abs(b);
      width2 = randx2 +  Math.abs(a);
      height2 = randy2 + Math.abs(b);
      //necessary to ensure that it is checked everytime it is bigger - if mouse if not moved
      checkOut();

    } else {
      newstart();
    }
  }

  //move right down
  function movementneg() {
    if ((width1 < canvas.width &&  width1 > 0 && height1 < canvas.width && height1 > 0) || (width2 < canvas.width &&  width2 > 0 && height2 < canvas.height && height2 > 0)){
      a = a - 3;
      b = b - 3;
      width1 = randx - Math.abs(a);
      height1 = randy - Math.abs(b);
      width2 = randx2 -  Math.abs(a);
      height2 = randy2 - Math.abs(b);
      //necessary to ensure that it is checked everytime it is bigger - if mouse if not moved
      checkOut(); 
    } else {
      newstart();
    }
  }
  //copied from https://stackoverflow.com/questions/17130395/real-mouse-position-in-canvas
  function getMousePos(evt) {

    var rect = canvas.getBoundingClientRect(), // abs. size of element
    scaleX = canvas.width / rect.width,    // relationship bitmap vs. element for x
    scaleY = canvas.height / rect.height;  // relationship bitmap vs. element for y

  return {
    x: (evt.clientX - rect.left) * scaleX,   // scale mouse coordinates after they have
    y: (evt.clientY - rect.top) * scaleY     // been adjusted to be relative to element
  }
}
//add values
function newstart() {
  a = 0;
      b = 0;
      randy = Math.floor(Math.random()* size);
      randx = Math.floor(Math.random()* size);
      randy2 = Math.floor(Math.random()* size);
      randx2 = Math.floor(Math.random()* size);
      width1 = randx;
      height1 = randy;
      width2 = randx2;
      height2 = randy2;
      rand = Math.random();
}
  //restart
  function stopmovement() {
    stopped = true;
    ctx.clearRect(0,0, canvas.width, canvas.height);
      a = 0;
      b = 0;
      randy = 0
      randx = 0
      randy2 = 0
      randx2 =0;
      width1 = randx;
      height1 = randy;
      width2 = randx2;
      height2 = randy2;
      rand = 0;
  }
</script>
</html>